<!DOCTYPE html>
<html lang="en">
  <head>
	<link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>SearchPage - FIT5225Assignment2</title>

    <meta name="description" content="Source code generated using layoutit.com">
    <meta name="author" content="LayoutIt!">

    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">

  </head>
  <style>
	body {
		background-image: url("{{ url_for('static', filename='./src.jpg') }}");
		background-attachment: scroll;
		background-size: 100%;
		opacity = 0.5;
	}
	.jumbotron {
		background-color: rgba(255,255,255,0.6);
	 }
	 #imagepreview {
		width: 300px;
		height: 200px;
	}
	
</style>
  <body>
	<nav class="navbar navbar-expand-lg navbar-light bg-light">
				 
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
			<span class="navbar-toggler-icon"></span>
		</button> <a class="navbar-brand" href="#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIT5225Assignment2</font></font></a>
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="navbar-nav">
				<li class="nav-item">
					 <a class="nav-link" href="/home"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Upload</font></font></a>
				</li>
				<li class="nav-item active">
					 <a class="nav-link" href="/search"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Search</font></font><span class="sr-only"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（当时的）</font></font></span></a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="/editPage"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edit</font></font></a>
			   </li>
			</ul>
			
			<ul class="navbar-nav ml-md-auto">
				<li class="nav-item active">
					 <a class="nav-link" href="/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Logout</font></font><span class="sr-only"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（当时的）</font></font></span></a>
				</li>

			</ul>
		</div>
	</nav>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-12">
				<div class="row">
					<div class="col-md-12">
						<div class="jumbotron">
							<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
								Tag Search
							</font></font></h2>
							<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
								Input your tag here 
							</font></font></p>
							<form class="form-inline">
								<div class="col-md-12">
									<p>
										<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
										Tag1 <span>&nbsp;&nbsp;</span>
									<input id="tagInput1" class="form-control mr-sm-2" type="text"> 
									<input id="tagNumber1" type="number" class="form-control mr-sm-2" value="1" min="0" max="9" step="1" data-decimals="2" data-suffix="°C"/>
									</p>

									<p>
										<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
										Tag2 <span>&nbsp;&nbsp;</span>
									<input id="tagInput2" class="form-control mr-sm-2" type="text"> 
									<input id="tagNumber2" type="number" class="form-control mr-sm-2" value="1" min="0" max="9" step="1" data-decimals="2" data-suffix="°C"/>
									</p>

									<p>
										<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
										Tag3 <span>&nbsp;&nbsp;</span>
									<input id="tagInput3" class="form-control mr-sm-2" type="text"> 
									<input id="tagNumber3" type="number" class="form-control mr-sm-2" value="1" min="0" max="9" step="1" data-decimals="2" data-suffix="°C"/>
									</p>
								</div>
								
								<button onclick="searchByTag()" class="btn btn-primary btn-lg btn-block" type="button"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
									Search
								</font></font></button>
								
							</form>
						</div>
					</div>
					<div class="col-md-12">
						<div class="jumbotron">
							<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
								Tag Search Result
							</font></font></h2>
							<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
								<strong>description:&nbsp;&nbsp;&nbsp;</strong> If you have only one tag input, please enter the tag in the first input low. And enter the second input low only if you have another tag and so on...Please enter multiple tags in order.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
							</font></font></p>
							<div class="list-group">
								 <a href="#" class="list-group-item list-group-item-action active">Your search URL result by the input tags are here :</a>
								<div class="list-group-item">
									<p id = "inputData">
										No input.
									</p>
								</div>
								<div class="list-group-item">
									<p id = "outputData">
										No output.
									</p>
									<ul id="tagSearchImageOutputArea" class="list-group list-group-flush">
									</ul>
								</div>
								
							</div>
							
						</div>

					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- 从这里开始是用Image搜Image -->
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-12">
				<div class="row">
					<div class="col-md-12">
						<!-- 上传Image部分 -->
						<div class="jumbotron">
							<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
								Image Search
							</font></font></h2>
							<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
								Choose your image here 
							</font></font></p>
							<div class="input-group mb-3">
								<div class="input-group-prepend">
								  <button id="imageSubmit" onclick="submitImage()" class="btn btn-primary btn-sm" disabled="true"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
									Search
								</font></font></button>
								</div>
								<div class="custom-file">
								  <input type="file" class="custom-file-input" id="imageInput" onchange="handleFileSelect(event)" aria-describedby="inputGroupFileAddon01">
								  <label class="custom-file-label" id="imageInputLabel" for="imageInput">Choose file</label>
								</div>
								
							</div>
						
							
							<div class="image-preview-section">
								<img id="imagePreview" src="" alt="" style="width: 700px; height: auto;" />
							</div>
						</div>
					</div>
					<div class="col-md-12">
						<div class="jumbotron">
							<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
								Image Rearch Result
							</font></font></h2>
							<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
								<strong>description:&nbsp;&nbsp;&nbsp;</strong> The Tag your &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
							</font></font></p>
							<div class="list-group">
								 <a href="#" class="list-group-item list-group-item-action active">Your search URL result by the input images are here :</a>
								<div class="list-group-item">
									<p id = "imageSearchInput">
										No input.
									</p>
								</div>
								<div class="list-group-item">
									<p id = "imageSearchOutput">
										No output.
									</p>
									<ul id="imageSearchImageOutputArea" class="list-group list-group-flush">
									</ul>
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>
		</div>
	</div>


	<script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
	<script>
		//这一段是用Image搜索的
		let imageData = '';
		let filename = '';
		function uploadButton() {
			document.getElementById('fileInput').click();
		}
	
		function handleFileSelect(event) {
			const file = event.target.files[0];
			filename = event.target.files[0].name;
			const reader = new FileReader();
			reader.onload = (event) => {
				imageData = event.target.result;
				document.getElementById('imagePreview').src = imageData;
			};
			document.getElementById("imageInputLabel").innerHTML = filename;
			document.getElementById("imageSubmit").removeAttribute("disabled");
			document.getElementById("imageSearchInput").innerHTML = "Input: " + filename;
			reader.readAsDataURL(file);   
		}
	
		function submitImage() {
			const imageSearchImageOutputArea = document.getElementById("imageSearchImageOutputArea");
			imageSearchImageOutputArea.innerHTML = "";
			const url = 'https://zfn0ptl3vb.execute-api.us-east-1.amazonaws.com/Upload2S3/api/imagedetectimage';
			const data = {
				"imageData": imageData.split(',')[1],
				"filename": filename
				};
			fetch(url, {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify(data)
			}).then(response => response.json())
			.then(data => {
				if(data.links == "No tags detected.")
				{
					alert("Can't be found!");
				}
				else{
					document.getElementById("imageSearchOutput").innerHTML = "Output: " + "<br>";
					console.log(data.links);
					var outArrary = data.links;
					for (const key in outArrary) {
					var outputNode = document.createElement("li");
					outputNode.setAttribute("class","list-group-item");
					var imageNode = document.createElement("img");
					imageNode.setAttribute("src", outArrary[key]);
					imageNode.setAttribute("class", "mr-3");
					imageNode.setAttribute("height", "240");
					var hNode = document.createElement("h5");
					hNode.setAttribute("class","mt-0 mb-1");
					var tempID = Number(key) + 1;
					hNode.innerHTML = "Result " + tempID;
					var pNode = document.createElement("p");
					pNode.innerHTML = "URL: " + outArrary[key];
					var mbodyNode = document.createElement("div");
					mbodyNode.setAttribute("class","media-body");
					mbodyNode.append(hNode);
					mbodyNode.append(pNode);
					outputNode.append(mbodyNode);
					outputNode.append(imageNode);
					imageSearchImageOutputArea.append(outputNode);
				}
			}
					 
			})
			.catch(error => console.error('Error:', error));;
		}
	</script>
	<script>
		// 这一段是用Tag搜索的
		function searchByTag(data) {
			const tagSearchImageOutputArea = document.getElementById("tagSearchImageOutputArea");
			tagSearchImageOutputArea.innerHTML = "";
            var url = 'https://92dso1b1yl.execute-api.us-east-1.amazonaws.com/dev/geturlsbytags'
			var tagInput1 = document.getElementById("tagInput1").value;
			var tagInput2 = document.getElementById("tagInput2").value;
			var tagInput3 = document.getElementById("tagInput3").value;
			var tagNumber1 = Number(document.getElementById("tagNumber1").value);
			var tagNumber2 = Number(document.getElementById("tagNumber2").value);
			var tagNumber3 = Number(document.getElementById("tagNumber3").value);
			if(tagInput2==""&&tagInput3==""){
				var data= {
                  "parameters": {
                    "tags": [
                      {
                        "tag": tagInput1,
                        "count": tagNumber1,
					  },
                    ]
                  }
                }
			}
			else if(tagInput3==""){
				var data= {
                  "parameters": {
                    "tags": [
                      {
                        "tag": tagInput1,
                        "count": tagNumber1,
					  },
					  {
                        "tag": tagInput2,
                        "count": tagNumber2,
					  },
                    ]
                  }
                }
			}
			else{
				var data = {
                  "parameters": {
                    "tags": [
                      {
                        "tag": tagInput1,
                        "count": tagNumber1,
					  },
					  {
                        "tag": tagInput2,
                        "count": tagNumber2,
					  },
					  {
                        "tag": tagInput3,
                        "count": tagNumber3,
					  }
                    ]
                  }
                }
			}
            console.log(data)
			document.getElementById("inputData").innerHTML = "Input: " + tagInput1 + " " + tagInput2 + " " + tagInput3;
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            }).then(res => res.json())
			.then(res => {
				document.getElementById("outputData").innerHTML = "Output: " + "<br>";
				console.log(res);
				var outArrary = res.body.links;
				for (const key in outArrary) {
					// document.getElementById("outputData").innerHTML += outArrary[key] + "<br>";
					var outputNode = document.createElement("li");
					outputNode.setAttribute("class","list-group-item");
					var imageNode = document.createElement("img");
					imageNode.setAttribute("src", outArrary[key]);
					imageNode.setAttribute("class", "mr-3");
					imageNode.setAttribute("height", "240");
					var hNode = document.createElement("h5");
					hNode.setAttribute("class","mt-0 mb-1");
					var tempID = Number(key) + 1;
					hNode.innerHTML = "Result " + tempID;
					var pNode = document.createElement("p");
					pNode.innerHTML = "URL: " + outArrary[key];
					var mbodyNode = document.createElement("div");
					mbodyNode.setAttribute("class","media-body");
					mbodyNode.append(hNode);
					mbodyNode.append(pNode);
					outputNode.append(mbodyNode);
					outputNode.append(imageNode);
					tagSearchImageOutputArea.append(outputNode);
				}
			})
        }
	</script>
  </body>
</html>